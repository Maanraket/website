(this["webpackJsonpvirtual-doom"]=this["webpackJsonpvirtual-doom"]||[]).push([[0],[,,,,,function(e,t,a){e.exports={side:"Television_side__2alSP",back:"Television_back__14DFJ",furniture:"Television_furniture__2Nb1W",furnitureSide:"Television_furnitureSide__1ePRi"}},function(e,t,a){e.exports={camera:"Camera_camera__R7wHe",scene:"Camera_scene__3xCWn",crosshair:"Camera_crosshair__1wcq6"}},,,function(e,t,a){e.exports={intro:"Player_intro__vwbZT"}},function(e,t,a){e.exports={wall:"Wall_wall__2DSA6"}},function(e,t,a){e.exports={transform:"Transform_transform__u4NgZ"}},function(e,t,a){e.exports={intersectable:"Intersectable_intersectable__1_1H4"}},function(e,t,a){e.exports={floor:"world_floor__12isS"}},function(e,t,a){e.exports=a.p+"static/media/statue.93683e48.png"},function(e,t,a){e.exports=a.p+"static/media/sliding-door.20fc4b30.png"},,,,,,,,,function(e,t,a){e.exports=a(46)},,,,,function(e,t,a){},,,,,,,,,,,,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(8),o=a.n(c),i=(a(29),a(2)),l=0,u=function(e){var t=l;return l++,"".concat(e,"-").concat(t)},s=new Map;!function e(){s.forEach((function(e,t){return e((function(){return s.delete(t)}))})),requestAnimationFrame(e)}();var m=function(e){var t=u("tick");Object(n.useEffect)((function(){return s.set(t,e),function(){s.delete(t)}}),[e])},f=a(1),d=new Map,v=function(e,t){var a=f.c.len(e),n=f.c.dot(e,t)/a;return n<0?null:f.c.scale(f.c.create(),e,n/a)},b=function(){var e=f.c.create(),t=f.c.create(),a=f.c.create(),n=f.c.create(),r=f.c.create();return function(c,o){f.c.subtract(e,o.position,c.position),f.c.cross(t,o.topSide,o.leftSide);var i=f.c.dot(c.direction,t),l=f.c.dot(e,t)/i;f.c.add(a,c.position,f.c.scale(r,c.direction,l)),f.c.sub(n,a,o.position);var u=v(o.leftSide,n),s=v(o.topSide,n);if(!u||!s)return-1;var m=f.c.length(u),d=f.c.length(s),b=f.c.length(o.leftSide),E=f.c.length(o.topSide);return m>=0&&m<=b&&d>=0&&d<=E?l:-1}}(),E=function(e,t){var a=Array();if(d.forEach((function(t,n){var r=b(e,t);r>0&&a.push({distance:r,key:n})})),a.sort((function(e,t){return e.distance<t.distance?-1:1})),a.length){var n=d.get(a[0].key);n&&n.callback&&n.callback(t)}return a},p=a(4),h=a(6),j=a.n(h),O=f.c.fromValues(0,1,0),w=function(e){var t=e.position,a=e.direction,c=e.perspective,o=Object(p.a)(e,["position","direction","perspective"]),l=Object(n.useState)(f.c.create()),u=Object(i.a)(l,1)[0],s=Object(n.useState)(f.a.create()),m=Object(i.a)(s,1)[0],d=Object(n.useState)(f.c.create()),v=Object(i.a)(d,1)[0],b=f.c.fromValues(0,0,-c),E={perspective:"".concat(c,"px")};f.c.add(u,t,b),f.a.lookAt(m,u,f.c.add(v,u,a),O);var h={transform:"matrix3d(".concat(m.join(","),")"),transformOrigin:"0 0 ".concat(c,"px")};return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:j.a.crosshair}),r.a.createElement("div",{style:E,className:j.a.camera},r.a.createElement("div",{style:h,className:j.a.scene},o.children)))},y=Object(n.createContext)(null),g=a(9),k=a.n(g),_=f.c.fromValues(0,0,0),x=f.c.fromValues(0,0,-1),S=f.a.fromYRotation(f.a.create(),.5*Math.PI),V=f.a.fromYRotation(f.a.create(),-.5*Math.PI),R=function(e){var t=Object(n.useState)(f.c.fromValues(0,0,0)),a=Object(i.a)(t,2),c=a[0],o=a[1],l=Object(n.useState)(f.c.fromValues(0,0,-1)),u=Object(i.a)(l,2),s=u[0],d=u[1],v=Object(n.useRef)({forward:!1,backward:!1,left:!1,right:!1}),b=Object(n.useRef)([0,0]),p=Object(n.useState)(!1),h=Object(i.a)(p,2),j=h[0],O=h[1],g=Object(n.useState)(null),R=Object(i.a)(g,2),N=R[0],C=R[1];Object(n.useEffect)((function(){var e=function(e){var t=e.code,a="keydown"===e.type;"KeyW"!==t&&"ArrowUp"!==t||(v.current.forward=a),"KeyS"!==t&&"ArrowDown"!==t||(v.current.backward=a),"KeyA"!==t&&"ArrowLeft"!==t||(v.current.left=a),"KeyD"!==t&&"ArrowRight"!==t||(v.current.right=a)};return window.addEventListener("keydown",e),window.addEventListener("keyup",e),function(){window.removeEventListener("keydown",e),window.removeEventListener("keyup",e)}}),[v]),Object(n.useEffect)((function(){var e=function(e){j&&(b.current=[b.current[0]+e.movementX,b.current[1]+e.movementY])};return window.addEventListener("mousemove",e),function(){return window.removeEventListener("mousemove",e)}}),[b,j]),Object(n.useEffect)((function(){var e=function(){O(!!document.pointerLockElement)},t=document.querySelector("body"),a=function(e){"A"!==e.target.nodeName&&t.requestPointerLock()};return document.addEventListener("mousedown",a),document.addEventListener("pointerlockchange",e,!1),function(){document.removeEventListener("mousedown",a),document.removeEventListener("pointerlockchange",e,!1)}}),[]);var L=Object(n.useCallback)((function(){if(j){var e=f.c.clone(x);f.c.rotateX(e,e,_,.0015*b.current[1]),f.c.rotateY(e,e,_,.0015*-b.current[0]),d(e);var t=f.c.fromValues(e[0],0,e[2]);f.c.scale(t,t,30);var a=f.c.create();v.current.forward&&f.c.add(a,a,t),v.current.backward&&f.c.add(a,a,f.c.negate(f.c.create(),t)),v.current.left&&f.c.add(a,a,f.c.transformMat4(f.c.create(),t,S)),v.current.right&&f.c.add(a,a,f.c.transformMat4(f.c.create(),t,V)),o((function(e){var t=E({position:e,direction:a}).filter((function(e){return e.distance>0&&e.distance<1})).sort();return t.length&&f.c.scale(a,a,(t[0].distance-.05)/1),f.c.add(f.c.create(),e,a)}))}}),[v,d,o,j]);return Object(n.useEffect)((function(){var e=E({position:c,direction:s}).filter((function(e){return e.distance>0}));e.length?C(e[0].key):C(null)}),[s,c]),Object(n.useEffect)((function(){var e=function(){E({position:c,direction:s},"click")};return window.addEventListener("click",e),function(){return window.removeEventListener("click",e)}}),[c,s]),m(L),r.a.createElement(r.a.Fragment,null,j?null:r.a.createElement("div",{className:k.a.intro},"Click anywhere to start. ",r.a.createElement("br",null),"Move your cursor to look around. ",r.a.createElement("br",null),"Use WASD or the arrow keys to walk around. ",r.a.createElement("br",null),"Works best in Firefox at time of writing. ",r.a.createElement("br",null),r.a.createElement("a",{href:"https://github.com/ath92/virtual-doom",target:"_blank"},"GitHub")),r.a.createElement(w,{position:c,direction:s,perspective:750},r.a.createElement(y.Provider,{value:N},e.children)))},N=a(10),C=a.n(N),L=Object(n.createContext)(f.a.create()),A=a(11),M=a.n(A),z=function(e){var t=e.value,a=Object(p.a)(e,["value"]),c=Object(n.useContext)(L),o=Object(n.useState)(f.a.create()),l=Object(i.a)(o,1)[0];f.a.multiply(l,c,t);var u={transform:"matrix3d(".concat(t.join(","),")")};return r.a.createElement("div",{style:u,className:M.a.transform},r.a.createElement(L.Provider,{value:l},a.children))},P=a(12),W=a.n(P),T=f.c.fromValues(0,0,0),F=f.c.fromValues(1,0,0),I=f.c.fromValues(0,1,0),Y=function(e){var t=e.callback,a=e.id,c=Object(p.a)(e,["callback","id"]),o=Object(n.useState)([0,0]),l=Object(i.a)(o,2),s=l[0],m=l[1],v=Object(n.useContext)(L),b=Object(n.useState)(a||u("inter")),E=Object(i.a)(b,1)[0],h=Object(n.useState)([f.c.create(),f.c.create(),f.c.create()]),j=Object(i.a)(h,1),O=Object(i.a)(j[0],3),w=O[0],y=O[1],g=O[2],k=Object(n.useCallback)((function(e){null!==e&&m([e.offsetWidth,e.offsetHeight])}),[m]);return Object(n.useEffect)((function(){var e,a;f.c.transformMat4(w,T,v),f.c.scale(y,F,s[0]),f.c.transformMat4(y,y,v),f.c.sub(y,y,w),f.c.scale(g,I,s[1]),f.c.transformMat4(g,g,v),f.c.sub(g,g,w),e=E,a={position:w,leftSide:g,topSide:y,callback:t},d.set(e,a)}),[s,v,E,t,w,y,g]),Object(n.useEffect)((function(){return function(){return e=E,void d.delete(e);var e}}),[E]),r.a.createElement("div",{ref:k,className:W.a.intersectable},c.children)},D=function(e){var t=e.yRotation,a=void 0===t?0:t,n=e.position,c=e.length,o=void 0===c?1e3:c,i=Object(p.a)(e,["yRotation","position","length"]),l=f.a.fromTranslation(f.a.create(),n);f.a.rotateY(l,l,a);var u={width:"".concat(o,"px")};return r.a.createElement(z,{value:l},r.a.createElement(Y,null,r.a.createElement("div",{className:C.a.wall,style:u},i.children)))},q=a(13),H=a.n(q),K=function(e){return e/180*Math.PI},B=function(e){var t=e.x,a=void 0===t?0:t,n=e.y,c=void 0===n?0:n,o=e.z,i=void 0===o?0:o,l=Object(p.a)(e,["x","y","z"]);return r.a.createElement(z,{value:f.a.fromQuat(f.a.create(),f.b.fromEuler(f.b.create(),a,c,i))},l.children)},J=function(e){var t=e.x,a=void 0===t?0:t,n=e.y,c=void 0===n?0:n,o=e.z,i=void 0===o?0:o,l=Object(p.a)(e,["x","y","z"]);return r.a.createElement(z,{value:f.a.fromTranslation(f.a.create(),f.c.fromValues(a,c,i))},l.children)},U=a(14),X=a.n(U),Z=a(15),G=a.n(Z),Q=function(e){var t=e.width,a=void 0===t?1e3:t,c=Object(n.useState)(0),o=Object(i.a)(c,2),l=o[0],s=o[1],f=Object(n.useState)(!1),d=Object(i.a)(f,2),v=d[0],b=d[1],E=Object(n.useState)(u("door")),p=Object(i.a)(E,1)[0],h=Object(n.useContext)(y);return m((function(e){var t=v?a:0;if(Math.abs(l-t)<2)return s(t),void e();s(l+(t-l)/5)})),r.a.createElement(J,{x:l},r.a.createElement(Y,{callback:function(e){"click"===e&&b(!v)},id:p},r.a.createElement("img",{src:G.a,width:a,style:{filter:h!==p?"brightness(0.9)":"none"},height:"1000"})))},$=a(19),ee=a(16),te=a(5),ae=a.n(te),ne=function(){var e=Object(n.useState)(null),t=Object(i.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(!1),l=Object(i.a)(o,2),u=l[0],s=l[1],m={width:"500px",height:"320px"},f=Object(n.useCallback)((function(e){c(e.target)}),[c]),d=Object(n.useCallback)((function(e){"click"===e&&null!==a&&(u?a.pauseVideo():a.playVideo(),s(!u))}),[a,s,u]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y,{callback:d,id:"video"},r.a.createElement("div",{style:m},r.a.createElement(ee.a,{videoId:"ICcFMBzOnYs",opts:Object($.a)({},m),onReady:f}))),r.a.createElement(J,{z:-320},r.a.createElement(B,{y:-90},r.a.createElement("div",{className:ae.a.side})),r.a.createElement(J,{x:500},r.a.createElement(B,{y:-90},r.a.createElement("div",{className:ae.a.side}))),r.a.createElement(J,{y:80},r.a.createElement("div",{className:ae.a.back}))),r.a.createElement(J,{y:320},r.a.createElement("div",{className:ae.a.furniture}),r.a.createElement(J,{z:-320},r.a.createElement("div",{className:ae.a.furniture}))))},re=function(){return r.a.createElement(J,{y:1e3},r.a.createElement(B,{x:90},Array(5).fill(0).map((function(e,t){return Array(12).fill(0).map((function(e,a){return r.a.createElement(J,{x:400*t-1e3,y:-400*a,key:"".concat(t).concat(a)},r.a.createElement("div",{className:H.a.floor}))}))}))))},ce=function(){return r.a.createElement(J,{z:-2750,x:650},r.a.createElement(B,{y:-35},r.a.createElement("img",{src:X.a,height:"1000"})))},oe=function(){return r.a.createElement(J,{y:-700},r.a.createElement(re,null),r.a.createElement(D,{position:f.c.fromValues(1e3,0,-1e3),yRotation:K(-90),length:1e3}),r.a.createElement(D,{position:f.c.fromValues(1e3,0,-2e3),yRotation:K(-90),length:1e3}),r.a.createElement(D,{position:f.c.fromValues(1e3,0,-3e3),yRotation:K(-90),length:1e3}),r.a.createElement(D,{position:f.c.fromValues(1e3,0,-4e3),yRotation:K(-90),length:1e3}),r.a.createElement(D,{position:f.c.fromValues(-1e3,0,0),yRotation:K(90),length:1e3}),r.a.createElement(D,{position:f.c.fromValues(-1e3,0,-1e3),yRotation:K(90),length:1e3}),r.a.createElement(D,{position:f.c.fromValues(-1e3,0,-2e3),yRotation:K(90),length:1e3}),r.a.createElement(D,{position:f.c.fromValues(-1e3,0,-3e3),yRotation:K(90),length:1e3}),r.a.createElement(D,{position:f.c.fromValues(-400,0,-3e3),length:1400}),r.a.createElement(J,{z:-2999,x:-1e3},r.a.createElement(Q,{width:600})),r.a.createElement(ce,null),r.a.createElement(J,{z:-3799,y:500},r.a.createElement(B,{y:-60},r.a.createElement(ne,null))),r.a.createElement(D,{position:f.c.fromValues(-1e3,0,-4e3),length:1e3}),r.a.createElement(D,{position:f.c.fromValues(0,0,-4e3),length:1e3}))},ie=(a(44),a(45),function(){return r.a.createElement("div",{className:"App"},r.a.createElement(R,null,r.a.createElement(oe,null)))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(ie,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}],[[24,1,2]]]);
//# sourceMappingURL=main.49e03378.chunk.js.map